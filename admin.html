<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração - JTR Digital Solutions</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Cabeçalho -->
    <header>
        <nav>
            <div class="logo">
                <a href="index.html"><i class="fas fa-store"></i> JTR Digital Solutions</a>
            </div>
            <ul class="nav-links" id="nav-links">
                <!-- Menu carregado via JavaScript -->
            </ul>
        </nav>
    </header>

    <main class="container">
        <h1><i class="fas fa-cog"></i> Painel de Administração</h1>
        
        <div id="admin-message" class="alert" style="display: none;"></div>
        
        <!-- Verificação de admin -->
        <div id="admin-check" style="text-align: center; padding: 40px;">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>A verificar permissões...</p>
        </div>
        
        <!-- Painel admin (só mostra se for admin) -->
        <div id="admin-panel" style="display: none;">
            <!-- Estatísticas rápidas -->
            <div class="admin-stats">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="total-users">0</h3>
                    <p>Utilizadores</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-box"></i>
                    <h3 id="total-products">0</h3>
                    <p>Produtos</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-shopping-cart"></i>
                    <h3 id="total-orders">0</h3>
                    <p>Encomendas</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3 id="total-revenue">€0</h3>
                    <p>Receita</p>
                </div>
            </div>
            
            <!-- Tabs do admin -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('products')">
                    <i class="fas fa-box"></i> Produtos
                </button>
                <button class="tab-btn" onclick="showTab('users')">
                    <i class="fas fa-users"></i> Utilizadores
                </button>
                <button class="tab-btn" onclick="showTab('orders')">
                    <i class="fas fa-shopping-cart"></i> Encomendas
                </button>
                <button class="tab-btn" onclick="showTab('jobs')">
                    <i class="fas fa-briefcase"></i> Empregos
                </button>
                <button class="tab-btn" onclick="showTab('settings')">
                    <i class="fas fa-cogs"></i> Configurações
                </button>
            </div>
            
            <!-- Conteúdo das tabs -->
            <div class="tab-content">
                <!-- Tab Produtos -->
                <div id="products-tab" class="tab-pane active">
                    <div class="tab-header">
                        <h2><i class="fas fa-box"></i> Gestão de Produtos</h2>
                        <button onclick="showAddProductForm()" class="btn btn-success">
                            <i class="fas fa-plus"></i> Adicionar Produto
                        </button>
                    </div>
                    
                    <!-- Formulário de adicionar produto (inicialmente oculto) -->
                    <div id="add-product-form" class="admin-form" style="display: none;">
                        <h3><i class="fas fa-plus-circle"></i> Novo Produto</h3>
                        <form id="new-product-form" onsubmit="addNewProduct(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome do Produto *</label>
                                    <input type="text" id="product-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Categoria *</label>
                                    <select id="product-category" required>
                                        <option value="">Selecionar...</option>
                                        <option value="Eletrónica">Eletrónica</option>
                                        <option value="Livros">Livros</option>
                                        <option value="Vestuário">Vestuário</option>
                                        <option value="Acessórios">Acessórios</option>
                                        <option value="Casa">Casa</option>
                                        <option value="Desporto">Desporto</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Preço (€) *</label>
                                    <input type="number" id="product-price" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label>Stock *</label>
                                    <input type="number" id="product-stock" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Descrição *</label>
                                <textarea id="product-description" rows="3" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>URL da Imagem</label>
                                <input type="text" id="product-image" placeholder="nome-da-imagem.jpg">
                                <small>Ex: phone.jpg, book.jpg (ficheiro deve estar na pasta /images/)</small>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Criar Produto
                                </button>
                                <button type="button" class="btn btn-outline" onclick="hideAddProductForm()">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Lista de produtos -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Categoria</th>
                                    <th>Preço</th>
                                    <th>Stock</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="products-table">
                                <!-- Produtos carregados via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="no-products" class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <p>Nenhum produto encontrado</p>
                    </div>
                </div>
                
                <!-- Tab Utilizadores -->
                <div id="users-tab" class="tab-pane">
                    <div class="tab-header">
                        <h2><i class="fas fa-users"></i> Gestão de Utilizadores</h2>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Tipo</th>
                                    <th>Data Registo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="users-table">
                                <!-- Utilizadores carregados via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Tab Encomendas -->
                <div id="orders-tab" class="tab-pane">
                    <div class="tab-header">
                        <h2><i class="fas fa-shopping-cart"></i> Gestão de Encomendas</h2>
                        <div class="filter-orders">
                            <select id="order-status-filter" onchange="filterOrders()">
                                <option value="">Todos os estados</option>
                                <option value="pendente">Pendente</option>
                                <option value="processando">Processando</option>
                                <option value="enviada">Enviada</option>
                                <option value="entregue">Entregue</option>
                                <option value="cancelada">Cancelada</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="orders-list" id="orders-list">
                        <!-- Encomendas carregadas via JavaScript -->
                    </div>
                </div>
                
                <!-- Tab Empregos -->
                <div id="jobs-tab" class="tab-pane">
                    <div class="tab-header">
                        <h2><i class="fas fa-briefcase"></i> Gestão de Empregos</h2>
                        <button onclick="showAddJobForm()" class="btn btn-success">
                            <i class="fas fa-plus"></i> Nova Vaga
                        </button>
                    </div>
                    
                    <!-- Formulário de nova vaga -->
                    <div id="add-job-form" class="admin-form" style="display: none;">
                        <h3><i class="fas fa-plus-circle"></i> Nova Vaga de Emprego</h3>
                        <form id="new-job-form" onsubmit="addNewJob(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Título *</label>
                                    <input type="text" id="job-title" required>
                                </div>
                                <div class="form-group">
                                    <label>Localização *</label>
                                    <select id="job-location" required>
                                        <option value="">Selecionar...</option>
                                        <option value="lisboa">Lisboa</option>
                                        <option value="porto">Porto</option>
                                        <option value="coimbra">Coimbra</option>
                                        <option value="aveiro">Aveiro</option>
                                        <option value="remote">Remoto</option>
                                        <option value="hibrido">Híbrido</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salário *</label>
                                    <input type="text" id="job-salary" placeholder="Ex: 30-40k/ano" required>
                                </div>
                                <div class="form-group">
                                    <label>Tipo de Contrato *</label>
                                    <select id="job-contract" required>
                                        <option value="">Selecionar...</option>
                                        <option value="efetivo">Efetivo</option>
                                        <option value="termo-certo">Termo Certo</option>
                                        <option value="estagio">Estágio</option>
                                        <option value="freelance">Freelance</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Descrição *</label>
                                <textarea id="job-description" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Requisitos (um por linha) *</label>
                                <textarea id="job-requirements" rows="3" placeholder="Experiência em...
Domínio de...
Boa comunicação..." required></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Publicar Vaga
                                </button>
                                <button type="button" class="btn btn-outline" onclick="hideAddJobForm()">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="jobs-list" id="admin-jobs-list">
                        <!-- Empregos carregados via JavaScript -->
                    </div>
                </div>
                
                <!-- Tab Configurações -->
                <div id="settings-tab" class="tab-pane">
                    <div class="tab-header">
                        <h2><i class="fas fa-cogs"></i> Configurações do Sistema</h2>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3><i class="fas fa-store"></i> Configurações da Loja</h3>
                            <form id="store-settings">
                                <div class="form-group">
                                    <label>Nome da Loja</label>
                                    <input type="text" value="JTR Digital Solutions">
                                </div>
                                <div class="form-group">
                                    <label>Email de Contacto</label>
                                    <input type="email" value="info@eshop.pt">
                                </div>
                                <div class="form-group">
                                    <label>Telefone</label>
                                    <input type="tel" value="+351 123 456 789">
                                </div>
                                <button type="submit" class="btn">Guardar</button>
                            </form>
                        </div>
                        
                        <div class="setting-card">
                            <h3><i class="fas fa-shipping-fast"></i> Configurações de Envio</h3>
                            <form id="shipping-settings">
                                <div class="form-group">
                                    <label>Portes Standard (€)</label>
                                    <input type="number" value="5.00" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Portes Expresso (€)</label>
                                    <input type="number" value="10.00" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Envio Grátis a partir de (€)</label>
                                    <input type="number" value="50.00" step="0.01">
                                </div>
                                <button type="submit" class="btn">Guardar</button>
                            </form>
                        </div>
                        
                        <div class="setting-card">
                            <h3><i class="fas fa-tools"></i> Ferramentas</h3>
                            <div class="tool-actions">
                                <button onclick="exportData()" class="btn">
                                    <i class="fas fa-download"></i> Exportar Dados
                                </button>
                                <button onclick="clearAllData()" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> Limpar Todos os Dados
                                </button>
                                <button onclick="resetDemoData()" class="btn btn-outline">
                                    <i class="fas fa-redo"></i> Reset Dados de Demonstração
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Acesso negado -->
        <div id="access-denied" class="access-denied" style="display: none;">
            <i class="fas fa-lock fa-5x"></i>
            <h2>Acesso Negado</h2>
            <p>Esta área é apenas para administradores.</p>
            <div class="denied-actions">
                <a href="index.html" class="btn">
                    <i class="fas fa-home"></i> Voltar à Página Inicial
                </a>
                <a href="login.html" class="btn btn-outline">
                    <i class="fas fa-sign-in-alt"></i> Fazer Login como Admin
                </a>
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>JTR Digital Solutions</h3>
                <p>Loja online com os melhores produtos</p>
            </div>
            <div class="footer-section">
                <h3>Contactos</h3>
                <p><i class="fas fa-envelope"></i> admin@eshop.pt</p>
                <p><i class="fas fa-phone"></i> +351 123 456 789</p>
            </div>
            <div class="footer-section">
                <h3>Administração</h3>
                <p><a href="admin.html">Painel Admin</a></p>
                <p><a href="produtos.html">Gestão Produtos</a></p>
                <p><a href="empregos.html">Gestão Empregos</a></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 JTR Digital Solutions. Todos os direitos reservados.</p>
            <p>Área restrita a administradores</p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let currentAdmin = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Primeiro verificar se está logado
            checkAdminAccess();
        });
        
        function checkAdminAccess() {
            const adminCheck = document.getElementById('admin-check');
            const adminPanel = document.getElementById('admin-panel');
            const accessDenied = document.getElementById('access-denied');
            
            // Verificar se está logado
            const user = app.getCurrentUser();
            
            if (!user) {
                // Não está logado
                adminCheck.innerHTML = `
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <h3>Não está autenticado</h3>
                    <p>Por favor, faça login para aceder ao painel de administração.</p>
                    <div style="margin-top: 20px;">
                        <a href="login.html" class="btn">Fazer Login</a>
                    </div>
                `;
                return;
            }
            
            // Verificar se é admin
            if (user.tipo !== 'admin') {
                // Não é admin
                adminCheck.style.display = 'none';
                accessDenied.style.display = 'block';
                return;
            }
            
            // É admin - mostrar painel
            currentAdmin = user;
            adminCheck.style.display = 'none';
            adminPanel.style.display = 'block';
            
            // Atualizar menu
            app.updateMenu();
            
            // Carregar dados do admin
            loadAdminData();
        }
        
        function loadAdminData() {
            // Atualizar estatísticas
            updateStats();
            
            // Carregar produtos
            loadProductsTable();
            
            // Carregar utilizadores
            loadUsersTable();
            
            // Carregar encomendas
            loadOrdersList();
            
            // Carregar empregos
            loadJobsList();
        }
        
        function updateStats() {
            // Utilizadores
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            document.getElementById('total-users').textContent = users.length;
            
            // Produtos
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            document.getElementById('total-products').textContent = products.length;
            
            // Encomendas
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            document.getElementById('total-orders').textContent = orders.length;
            
            // Receita total
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('total-revenue').textContent = `€${totalRevenue.toFixed(2)}`;
        }
        
        function showTab(tabName) {
            // Remover active de todos os tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Ativar tab selecionada
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        function showAddProductForm() {
            document.getElementById('add-product-form').style.display = 'block';
            document.getElementById('new-product-form').reset();
        }
        
        function hideAddProductForm() {
            document.getElementById('add-product-form').style.display = 'none';
        }
        
        function addNewProduct(event) {
            event.preventDefault();
            
            const product = {
                nome: document.getElementById('product-name').value,
                categoria: document.getElementById('product-category').value,
                preco: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                descricao: document.getElementById('product-description').value,
                imagem: document.getElementById('product-image').value || 'default.jpg'
            };
            
            // Adicionar produto usando o método do app
            const newProduct = app.addProduct(product);
            
            if (newProduct) {
                showMessage('Produto adicionado com sucesso!', 'success');
                hideAddProductForm();
                loadProductsTable();
                updateStats();
            }
        }
        
        function loadProductsTable() {
            const products = app.getProducts();
            const table = document.getElementById('products-table');
            const noProducts = document.getElementById('no-products');
            
            if (products.length === 0) {
                table.innerHTML = '';
                noProducts.style.display = 'block';
                return;
            }
            
            noProducts.style.display = 'none';
            
            table.innerHTML = products.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td><strong>${product.nome}</strong></td>
                    <td><span class="category-badge">${product.categoria}</span></td>
                    <td>€${product.preco.toFixed(2)}</td>
                    <td>
                        <span class="stock-badge ${product.stock > 0 ? 'in-stock' : 'out-stock'}">
                            ${product.stock}
                        </span>
                    </td>
                    <td>
                        <button onclick="editProduct(${product.id})" class="btn-small">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="btn-small btn-danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja eliminar este produto?')) {
                app.deleteProduct(productId);
                showMessage('Produto eliminado!', 'success');
                loadProductsTable();
                updateStats();
            }
        }
        
        function editProduct(productId) {
            const products = app.getProducts();
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Preencher formulário com dados do produto
            document.getElementById('product-name').value = product.nome;
            document.getElementById('product-category').value = product.categoria;
            document.getElementById('product-price').value = product.preco;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-description').value = product.descricao;
            document.getElementById('product-image').value = product.imagem || '';
            
            // Mostrar formulário com botão de atualizar
            document.getElementById('add-product-form').style.display = 'block';
            
            // Alterar formulário para atualizar
            const form = document.getElementById('new-product-form');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateProduct(productId);
            };
            
            // Alterar botão
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Produto';
            submitBtn.onclick = function() {
                updateProduct(productId);
            };
        }
        
        function updateProduct(productId) {
            const updatedProduct = {
                nome: document.getElementById('product-name').value,
                categoria: document.getElementById('product-category').value,
                preco: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                descricao: document.getElementById('product-description').value,
                imagem: document.getElementById('product-image').value || 'default.jpg'
            };
            
            // Atualizar no localStorage
            let products = JSON.parse(localStorage.getItem('products') || '[]');
            const index = products.findIndex(p => p.id === productId);
            
            if (index !== -1) {
                products[index] = { ...products[index], ...updatedProduct };
                localStorage.setItem('products', JSON.stringify(products));
                
                showMessage('Produto atualizado com sucesso!', 'success');
                hideAddProductForm();
                loadProductsTable();
            }
        }
        
        function loadUsersTable() {
            const users = app.getAllUsers();
            const table = document.getElementById('users-table');
            
            table.innerHTML = users.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td><strong>${user.username}</strong></td>
                    <td>${user.email}</td>
                    <td>
                        <span class="user-type ${user.tipo}">
                            ${user.tipo === 'admin' ? 'Administrador' : 'Cliente'}
                        </span>
                    </td>
                    <td>${new Date(user.data_registo).toLocaleDateString('pt-PT')}</td>
                    <td>
                        ${user.tipo !== 'admin' ? `
                        <button onclick="makeAdmin(${user.id})" class="btn-small">
                            <i class="fas fa-user-shield"></i> Tornar Admin
                        </button>
                        ` : ''}
                        <button onclick="viewUserDetails(${user.id})" class="btn-small">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        function makeAdmin(userId) {
            if (confirm('Tornar este utilizador administrador?')) {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                const index = users.findIndex(u => u.id === userId);
                
                if (index !== -1) {
                    users[index].tipo = 'admin';
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Se for o utilizador atual, atualizar sessão
                    const currentUser = app.getCurrentUser();
                    if (currentUser && currentUser.id === userId) {
                        currentUser.tipo = 'admin';
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    }
                    
                    showMessage('Utilizador agora é administrador!', 'success');
                    loadUsersTable();
                }
            }
        }
        
        function viewUserDetails(userId) {
            const users = app.getAllUsers();
            const user = users.find(u => u.id === userId);
            
            if (!user) return;
            
            const details = `
                Detalhes do Utilizador #${user.id}
                
                Username: ${user.username}
                Email: ${user.email}
                Tipo: ${user.tipo}
                Data de Registo: ${new Date(user.data_registo).toLocaleString('pt-PT')}
                
                ${user.firstName ? `Nome: ${user.firstName} ${user.lastName}` : ''}
                ${user.phone ? `Telefone: ${user.phone}` : ''}
                ${user.birthdate ? `Data Nascimento: ${user.birthdate}` : ''}
            `;
            
            alert(details);
        }
        
        function loadOrdersList() {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const container = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma encomenda encontrada</p></div>';
                return;
            }
            
            container.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <h4>Encomenda #${order.id}</h4>
                        <span class="order-status ${order.status}">${getStatusText(order.status)}</span>
                    </div>
                    <div class="order-info">
                        <p><strong>Cliente ID:</strong> ${order.userId}</p>
                        <p><strong>Data:</strong> ${new Date(order.date).toLocaleDateString('pt-PT')}</p>
                        <p><strong>Total:</strong> €${order.total.toFixed(2)}</p>
                        ${order.shippingAddress ? `<p><strong>Morada:</strong> ${order.shippingAddress}</p>` : ''}
                    </div>
                    <div class="order-actions">
                        <button onclick="updateOrderStatus(${order.id})" class="btn-small">
                            <i class="fas fa-edit"></i> Alterar Estado
                        </button>
                        <button onclick="viewOrderDetails(${order.id})" class="btn-small">
                            <i class="fas fa-eye"></i> Detalhes
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function filterOrders() {
            const status = document.getElementById('order-status-filter').value;
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            
            let filtered = orders;
            if (status) {
                filtered = orders.filter(order => order.status === status);
            }
            
            const container = document.getElementById('orders-list');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma encomenda encontrada</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <h4>Encomenda #${order.id}</h4>
                        <span class="order-status ${order.status}">${getStatusText(order.status)}</span>
                    </div>
                    <div class="order-info">
                        <p><strong>Cliente ID:</strong> ${order.userId}</p>
                        <p><strong>Data:</strong> ${new Date(order.date).toLocaleDateString('pt-PT')}</p>
                        <p><strong>Total:</strong> €${order.total.toFixed(2)}</p>
                    </div>
                    <div class="order-actions">
                        <button onclick="updateOrderStatus(${order.id})" class="btn-small">
                            <i class="fas fa-edit"></i> Alterar Estado
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateOrderStatus(orderId) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (!order) return;
            
            const newStatus = prompt(`Alterar estado da encomenda #${orderId} (atual: ${order.status}):\n\nOpções: pendente, processando, enviada, entregue, cancelada`, order.status);
            
            if (newStatus && ['pendente', 'processando', 'enviada', 'entregue', 'cancelada'].includes(newStatus)) {
                order.status = newStatus;
                localStorage.setItem('orders', JSON.stringify(orders));
                showMessage('Estado da encomenda atualizado!', 'success');
                loadOrdersList();
            }
        }
        
        function viewOrderDetails(orderId) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (!order) return;
            
            const details = `
                Encomenda #${order.id}
                
                Cliente ID: ${order.userId}
                Data: ${new Date(order.date).toLocaleString('pt-PT')}
                Total: €${order.total.toFixed(2)}
                Estado: ${order.status}
                ${order.shippingAddress ? `Morada: ${order.shippingAddress}` : ''}
                ${order.trackingNumber ? `Rastreio: ${order.trackingNumber}` : ''}
                
                Itens: ${order.items ? order.items.length : 0}
            `;
            
            alert(details);
        }
        
        function showAddJobForm() {
            document.getElementById('add-job-form').style.display = 'block';
            document.getElementById('new-job-form').reset();
        }
        
        function hideAddJobForm() {
            document.getElementById('add-job-form').style.display = 'none';
        }
        
        function addNewJob(event) {
            event.preventDefault();
            
            const job = {
                titulo: document.getElementById('job-title').value,
                localizacao: document.getElementById('job-location').value,
                salario: document.getElementById('job-salary').value,
                contract: document.getElementById('job-contract').value,
                descricao: document.getElementById('job-description').value,
                requirements: document.getElementById('job-requirements').value.split('\n').filter(req => req.trim()),
                data_publicacao: new Date().toISOString()
            };
            
            // Adicionar ao localStorage
            let jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
            const newJob = {
                id: jobs.length > 0 ? Math.max(...jobs.map(j => j.id)) + 1 : 1,
                ...job
            };
            
            jobs.push(newJob);
            localStorage.setItem('jobs', JSON.stringify(jobs));
            
            showMessage('Vaga publicada com sucesso!', 'success');
            hideAddJobForm();
            loadJobsList();
        }
        
        function loadJobsList() {
            const jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
            const container = document.getElementById('admin-jobs-list');
            
            if (jobs.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma vaga publicada</p></div>';
                return;
            }
            
            container.innerHTML = jobs.map(job => `
                <div class="job-card">
                    <div class="job-header">
                        <h4>${job.titulo}</h4>
                        <span class="job-location">${job.localizacao}</span>
                    </div>
                    <div class="job-info">
                        <p><strong>Salário:</strong> ${job.salario}</p>
                        <p><strong>Contrato:</strong> ${job.contract}</p>
                        <p><strong>Publicada:</strong> ${new Date(job.data_publicacao).toLocaleDateString('pt-PT')}</p>
                    </div>
                    <div class="job-actions">
                        <button onclick="editJob(${job.id})" class="btn-small">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button onclick="deleteJob(${job.id})" class="btn-small btn-danger">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function deleteJob(jobId) {
            if (confirm('Eliminar esta vaga de emprego?')) {
                let jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
                jobs = jobs.filter(job => job.id !== jobId);
                localStorage.setItem('jobs', JSON.stringify(jobs));
                
                showMessage('Vaga eliminada!', 'success');
                loadJobsList();
            }
        }
        
        function editJob(jobId) {
            const jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
            const job = jobs.find(j => j.id === jobId);
            
            if (!job) return;
            
            // Preencher formulário
            document.getElementById('job-title').value = job.titulo;
            document.getElementById('job-location').value = job.localizacao;
            document.getElementById('job-salary').value = job.salario;
            document.getElementById('job-contract').value = job.contract;
            document.getElementById('job-description').value = job.descricao;
            document.getElementById('job-requirements').value = job.requirements.join('\n');
            
            // Mostrar formulário
            showAddJobForm();
            
            // Alterar para modo edição
            const form = document.getElementById('new-job-form');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateJob(jobId);
            };
            
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Vaga';
        }
        
        function updateJob(jobId) {
            const updatedJob = {
                titulo: document.getElementById('job-title').value,
                localizacao: document.getElementById('job-location').value,
                salario: document.getElementById('job-salary').value,
                contract: document.getElementById('job-contract').value,
                descricao: document.getElementById('job-description').value,
                requirements: document.getElementById('job-requirements').value.split('\n').filter(req => req.trim())
            };
            
            let jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
            const index = jobs.findIndex(j => j.id === jobId);
            
            if (index !== -1) {
                jobs[index] = { ...jobs[index], ...updatedJob };
                localStorage.setItem('jobs', JSON.stringify(jobs));
                
                showMessage('Vaga atualizada!', 'success');
                hideAddJobForm();
                loadJobsList();
            }
        }
        
        function exportData() {
            const data = {
                users: JSON.parse(localStorage.getItem('users') || '[]'),
                products: JSON.parse(localStorage.getItem('products') || '[]'),
                orders: JSON.parse(localStorage.getItem('orders') || '[]'),
                jobs: JSON.parse(localStorage.getItem('jobs') || '[]'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `eshop-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('Dados exportados com sucesso!', 'success');
        }
        
        function clearAllData() {
            if (confirm('⚠️ ATENÇÃO: Isto eliminará TODOS os dados (utilizadores, produtos, encomendas). Tem certeza?')) {
                localStorage.clear();
                showMessage('Todos os dados foram eliminados. A página será recarregada.', 'warning');
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }
        
        function resetDemoData() {
            if (confirm('Restaurar dados de demonstração? Isto substituirá os dados atuais.')) {
                // Executar o initDatabase do app.js
                app.initDatabase();
                showMessage('Dados de demonstração restaurados!', 'success');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        }
        
        function getStatusText(status) {
            const statusMap = {
                'pendente': 'Pendente',
                'processando': 'Processando',
                'enviada': 'Enviada',
                'entregue': 'Entregue',
                'cancelada': 'Cancelada'
            };
            return statusMap[status] || status;
        }
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('admin-message');
            messageDiv.textContent = text;
            messageDiv.className = `alert alert-${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
    </script>
    
    <style>
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin: 10px 0;
            color: #333;
        }
        
        .stat-card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .admin-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: #f5f5f5;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
        }
        
        .tab-btn.active {
            background: #4CAF50;
            color: white;
        }
        
        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .tab-header h2 {
            margin: 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #4CAF50;
        }
        
        .admin-form h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        small {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .category-badge {
            display: inline-block;
            padding: 3px 10px;
            background: #e3f2fd;
            color: #1565c0;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .stock-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .stock-badge.in-stock {
            background: #d4edda;
            color: #155724;
        }
        
        .stock-badge.out-stock {
            background: #f8d7da;
            color: #721c24;
        }
        
        .user-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .user-type.admin {
            background: #4CAF50;
            color: white;
        }
        
        .user-type.user {
            background: #2196F3;
            color: white;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.85rem;
            margin: 0 5px;
        }
        
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .order-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .order-status {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .order-status.pendente {
            background: #fff3cd;
            color: #856404;
        }
        
        .order-status.processando {
            background: #cce5ff;
            color: #004085;
        }
        
        .order-status.enviada {
            background: #d4edda;
            color: #155724;
        }
        
        .order-status.entregue {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .order-status.cancelada {
            background: #f8d7da;
            color: #721c24;
        }
        
        .order-info {
            margin-bottom: 15px;
        }
        
        .order-info p {
            margin: 5px 0;
            color: #666;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
        }
        
        .jobs-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .job-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #eee;
        }
        
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .job-header h4 {
            margin: 0;
            color: #333;
        }
        
        .job-location {
            color: #666;
            font-size: 0.9rem;
        }
        
        .job-info {
            margin-bottom: 15px;
        }
        
        .job-info p {
            margin: 5px 0;
            color: #666;
        }
        
        .job-actions {
            display: flex;
            gap: 10px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .setting-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        .setting-card h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tool-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .access-denied {
            text-align: center;
            padding: 60px 20px;
        }
        
        .access-denied i {
            color: #f44336;
            margin-bottom: 20px;
        }
        
        .access-denied h2 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .access-denied p {
            color: #666;
            margin-bottom: 30px;
        }
        
        .denied-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .filter-orders select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            .admin-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                justify-content: center;
            }
            
            .tab-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .denied-actions {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>